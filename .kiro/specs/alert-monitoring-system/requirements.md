# Requirements Document

## Introduction

This document defines the requirements for an Alert Monitoring System that enables property owners to receive, view, and manage real-time alerts from IoT devices across their properties. The system provides a backend API for alert ingestion and management, real-time WebSocket updates, and frontend interfaces for alert visualization and interaction.

## Glossary

- **Alert System**: The complete alert monitoring and management platform
- **Alert**: A notification generated by an IoT device indicating an event requiring attention
- **Owner Dashboard**: The web interface displaying a list of all alerts for a property owner
- **Alert Detail Page**: The web interface showing detailed information about a single alert
- **Backend API**: The Express.js server handling alert data and business logic
- **WebSocket Server**: The real-time communication channel for live alert updates
- **Alert Database**: The SQLite database storing alert and history records
- **Severity Level**: The priority classification of an alert (low, high, critical)
- **Alert Status**: The current state of an alert (open, acknowledged, resolved)
- **Alert History**: The audit trail of all actions performed on an alert

## Requirements

### Requirement 1

**User Story:** As a property owner, I want to see all alerts from my properties in real-time, so that I can quickly respond to security or safety events.

#### Acceptance Criteria

1. WHEN the Owner Dashboard loads, THE Alert System SHALL retrieve and display all alerts ordered by timestamp descending
2. WHEN a new alert is created, THE Alert System SHALL broadcast the alert to all connected clients via WebSocket within 1 second
3. WHEN an alert is updated, THE Alert System SHALL broadcast the updated alert to all connected clients via WebSocket within 1 second
4. THE Alert System SHALL display alert count, timestamp, type, house ID, severity, and status for each alert in the list
5. THE Alert System SHALL provide clickable links to view detailed information for each alert

### Requirement 2

**User Story:** As a property owner, I want to filter alerts by status, so that I can focus on alerts that require my attention.

#### Acceptance Criteria

1. THE Alert System SHALL provide a status filter with options for "All", "open", "acknowledged", and "resolved"
2. WHEN a status filter is selected, THE Alert System SHALL retrieve and display only alerts matching the selected status
3. THE Alert System SHALL update the alert count to reflect the number of filtered alerts
4. THE Alert System SHALL maintain filter selections until the user changes them

### Requirement 3

**User Story:** As a property owner, I want to generate test alerts, so that I can verify the system is working correctly.

#### Acceptance Criteria

1. THE Alert System SHALL provide buttons to generate glass break, smoke alarm, and dog bark test alerts
2. WHEN a generator button is clicked, THE Alert System SHALL create a new alert with the corresponding type and appropriate severity
3. THE Alert System SHALL assign severity "high" to glass break alerts
4. THE Alert System SHALL assign severity "critical" to smoke alarm alerts
5. THE Alert System SHALL assign severity "low" to dog bark alerts

### Requirement 4

**User Story:** As a property owner, I want to view detailed information about a specific alert, so that I can understand the full context before taking action.

#### Acceptance Criteria

1. WHEN an alert detail page loads, THE Alert System SHALL retrieve and display the alert's type, severity, status, message, and creation timestamp
2. THE Alert System SHALL retrieve and display the complete history of actions performed on the alert
3. THE Alert System SHALL display history entries with timestamp, action type, actor, and optional notes
4. THE Alert System SHALL order history entries chronologically from oldest to newest
5. THE Alert System SHALL provide a link to return to the Owner Dashboard

### Requirement 5

**User Story:** As a property owner, I want to acknowledge alerts, so that I can indicate I am aware of the issue and am taking action.

#### Acceptance Criteria

1. THE Alert System SHALL provide an "Acknowledge" button on the Alert Detail Page
2. WHEN the acknowledge button is clicked, THE Alert System SHALL update the alert status to "acknowledged"
3. WHEN an alert is acknowledged, THE Alert System SHALL record the actor name and timestamp
4. WHEN an alert is acknowledged, THE Alert System SHALL create a history entry with action "ack"
5. WHEN an alert is acknowledged, THE Alert System SHALL refresh the displayed alert information within 1 second

### Requirement 6

**User Story:** As a property owner, I want to resolve alerts, so that I can mark issues as completed and remove them from my active alert list.

#### Acceptance Criteria

1. THE Alert System SHALL provide a "Resolve" button on the Alert Detail Page
2. WHEN the resolve button is clicked, THE Alert System SHALL update the alert status to "resolved"
3. WHEN an alert is resolved, THE Alert System SHALL record the actor name and timestamp
4. WHEN an alert is resolved, THE Alert System SHALL create a history entry with action "resolve"
5. WHEN an alert is resolved, THE Alert System SHALL refresh the displayed alert information within 1 second

### Requirement 7

**User Story:** As an IoT device, I want to send alerts to the system via API, so that property owners are notified of detected events.

#### Acceptance Criteria

1. THE Backend API SHALL provide a POST endpoint at "/api/v1/alerts/ingest" for alert creation
2. WHEN an alert is ingested, THE Backend API SHALL accept tenant_id, house_id, device_id, type, and message parameters
3. WHEN an alert is ingested without a type parameter, THE Backend API SHALL return a 400 error with message "type required"
4. WHEN an alert is ingested, THE Backend API SHALL assign severity based on the alert type using predefined rules
5. WHEN an alert is ingested, THE Backend API SHALL create the alert with status "open" and generate a unique ID
6. WHEN an alert is ingested, THE Backend API SHALL create a history entry with action "created"
7. WHEN an alert is ingested, THE Backend API SHALL log a notification action indicating email would be sent to the owner

### Requirement 8

**User Story:** As a system administrator, I want alerts to be stored persistently, so that alert data is not lost if the server restarts.

#### Acceptance Criteria

1. THE Backend API SHALL use SQLite database with WAL mode enabled for data persistence
2. THE Alert Database SHALL store alert records with id, tenant_id, house_id, device_id, type, severity, status, message, timestamp, and acknowledgment/resolution metadata
3. THE Alert Database SHALL store history records with id, alert_id, action, actor, note, and timestamp
4. THE Backend API SHALL create database tables on startup if they do not exist
5. THE Backend API SHALL maintain referential integrity between alerts and their history records

### Requirement 9

**User Story:** As a property owner, I want to search for alerts by multiple criteria, so that I can find specific alerts quickly.

#### Acceptance Criteria

1. THE Backend API SHALL provide a POST endpoint at "/api/v1/alerts/search" for alert queries
2. THE Backend API SHALL support filtering by severity, status, type, and since timestamp
3. THE Backend API SHALL support limiting the number of results returned with a default limit of 50
4. WHEN multiple filters are provided, THE Backend API SHALL apply all filters using AND logic
5. THE Backend API SHALL return alerts ordered by timestamp descending

### Requirement 10

**User Story:** As a frontend application, I want to establish WebSocket connections for real-time updates, so that users see changes immediately without refreshing.

#### Acceptance Criteria

1. THE WebSocket Server SHALL listen for connections at path "/ws"
2. WHEN a client connects, THE WebSocket Server SHALL send a "hello" message with payload "connected"
3. THE WebSocket Server SHALL broadcast messages to all connected clients when alerts are created or updated
4. THE WebSocket Server SHALL send messages in JSON format with "type" and "payload" fields
5. THE WebSocket Server SHALL only send to clients with ready state equal to 1 (open connection)
